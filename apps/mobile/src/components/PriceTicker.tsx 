import React, { useEffect, useState } from 'react';
import { View, Text, StyleSheet } from 'react-native';
import axios from 'axios';

interface Props { symbol: string; }

export default function PriceTicker({ symbol }: Props) {
  const [price, setPrice] = useState<number | null>(null);
  const [change, setChange] = useState<number>(0);

  useEffect(() => {
    async function fetchPrice() {
      const res = await axios.get(
        `https://api.coingecko.com/api/v3/simple/price?ids=${symbol.toLowerCase()}&vs_currencies=usd&include_24hr_change=true`
      );
      const data = res.data[symbol.toLowerCase()];
      setPrice(data.usd);
      setChange(data.usd_24h_change);
    }
    fetchPrice();
    const id = setInterval(fetchPrice, 15000);
    return () => clearInterval(id);
  }, [symbol]);

  return (
    <View style={styles.row}>
      <Text style={styles.sym}>{symbol}</Text>
      <Text style={styles.price}>${price?.toFixed(2)}</Text>
      <Text style={[styles.change, { color: change >= 0 ? '#0f0' : '#f00' }]}>
        {change?.toFixed(2)}%
      </Text>
    </View>
  );
}

const styles = StyleSheet.create({
  row: { flexDirection: 'row', alignItems: 'center', marginVertical: 4 },
  sym: { color: '#fff', fontWeight: 'bold', width: 50 },
  price: { color: '#fff', marginHorizontal: 8 },
  change: { fontWeight: '600' },
});
